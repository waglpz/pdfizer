FROM php:7.4

RUN mkdir -p /usr/share/man/man1
# core Debian packages which includes of create PHP environment
RUN apt-get update;                 \
    apt-get install                 \
            -y                      \
            --no-install-recommends \
        default-jdk                 \
        enscript                    \
        ghostscript                 \
        libicu-dev                  \
        pdftk-java                  \
        autoconf                    \
        git                         \
        libzip-dev                  \
        locales                     \
        unzip                       \
        zlib1g-dev                  \
    ;                               \
    rm -rf /var/lib/apt/lists/*;    \
    rm -rf /var/cache/apt;          \
    apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false

## core PHP extensions
RUN docker-php-ext-enable opcache;               \
    docker-php-ext-install pcntl                 \
    ;                                            \
    pecl install apcu                            \
    ;                                            \
    docker-php-ext-enable apcu

# intl
RUN docker-php-ext-configure intl --enable-intl \
    && docker-php-ext-install intl 

# set default php.ini from production template
RUN mv "$PHP_INI_DIR/php.ini-production" "$PHP_INI_DIR/php.ini"

# xdebug
# we do not enable by default the extension
# because this is done in php-ini-overrides.ini when needed
RUN pecl install xdebug

# composer
ENV COMPOSER_HOME /var/www/composer

RUN curl -sS https://getcomposer.org/installer |                \
       php -- --install-dir=/usr/local/bin --filename=composer  \
    && composer global require maglnet/composer-require-checker

WORKDIR /app
